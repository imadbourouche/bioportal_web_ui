- @title = "Account Information"

%div{style: "padding: 1em;"}
  %table.form
    %tr
      %th.top First Name:
      %td.top= @user.firstName
    %tr
      %th Last Name:
      %td= @user.lastName
    %tr
      %th Email Address:
      %td= @user.email
    %tr
      %th Account Name:
      %td= @user.username
    %tr
      %td{colspan: "2", style: "text-align: right;"}
        = link_to "Edit Information", edit_user_path(url_encode(@user.username))
  %br/
  %h2
    API Key
    %span{style: "font-weight: normal; padding-left: 1em; font-size: x-small; color: gray;"} Your API Key can be used to access the NCBO API (REST) Services
  %p{style: "padding-top: .5em;"}
    = session[:user].apikey
  %br/


  - unless @user.subscription.nil? || @user.subscription.empty?
    %h2{style: "font-size: large;"} Subscriptions
    %table
      - @user.subscription.each do |subscription|
        - ont_id = subscription[:ontology]
        - ont = ont_id.nil? ? nil: subscription[:ontology].split('/').last
        - type = subscription[:notification_type].nil? ? nil : subscription[:notification_type].downcase
        %tr{style: "padding: 5px;"}
          %td{style: "padding: 5px;"}
            %a{href: "/ontologies/#{ont}"}= ont
          %td{style: "padding: 5px;"}
            - if type == "notes"
              %a{href: "/ontologies/#{ont}?p=notes"}= type
            - else
              = type
          %td{style: "padding: 5px;"}
            .subscribe_to_ontology{style: "float: left;"}
              = subscribe_button(ont_id)
    %br/

  - unless @user_projects.nil? || @user_projects.empty?
    %h2#user_projects{style: "font-size: large;"}
      Projects Created
    %ul{style: "padding-left: 1em;"}
      - @user_projects.each do |project|
        %li
          %a{href: "/projects/#{project.acronym}"}= project.name
    %br/

  - unless @admin_ontologies.nil? || @admin_ontologies.empty?
    %h2#admin_ontologies{style: "font-size: large;"}
      Submitted Semantic Resources
    %ul{style: "padding-left: 1em;"}
      - @admin_ontologies.each do |ont|
        %li
          %a{href: "/ontologies/#{ont.acronym}"}= ont.name
    %br

  :javascript
    jQuery(document).ready(function(){
      jQuery("#edit_custom_ontologies").click(editCustomOntologies);
    });


    function editCustomOntologies() {
      jQuery("#custom_ontologies_picker").css("left", "").css("position", "");
      jQuery("#custom_ontologies").hide();
    }

  %h2#custom_ontology_set{style: "font-size: large;"}
    Custom Semantic Resource Set
  #custom_ontologies.enable-lists
    - if at_slice?
      %p{style: "font-size: 10pt; margin: -3px 0 7px;"}
        Please
        %a{href: "#{$UI_URL}/account"} visit the main site
        to modify your Custom Semantic Resource Set.
    - else
      %p{style: "font-size: 9pt; color: gray; margin: -3px 0 7px;"}
        %b
          Customize your #{$SITE} display:
        Pick the semantic resources that you want to see and #{$SITE} will hide all other semantic resources. <br/>
        %b
          Note:
        this feature works only when you are logged in.
      %p
        %span{style: "font-weight: normal; font-size: 9pt; padding-left: 7px;"}
          %a#edit_custom_ontologies{href: "javascript:void(0);"} select semantic resources
      - if @user_ontologies && !@user_ontologies.empty?
        %ul
          - @user_ontologies.each do |ont|
            - ont = LinkedData::Client::Models::Ontology.get(ont)
            %li
              #{ont.name} (#{ont.acronym})
      - else
        %p{style: "padding-left: 7px;"} You haven't picked any ontologies yet

        %div
          %h2{style:"margin-top:18px; font-size: large;"} Mailing list service

          %div{style:"margin-top:12px"}
            %div
              %button.btn.btn-primary{id: "subscribe"}
                Subscribe
              %span to the #{$ANNOUNCE_LIST} user mailing list
            %div.mt-1
              %button.btn.btn-primary{id: "unsubscribe"}
                Unsubscribe
              %span from the #{$ANNOUNCE_LIST} user mailing list


            :javascript
              document.getElementById('subscribe').addEventListener('click', function() {
                  window.location.href = "/users/subscribe/" + "#{@user.username}"

              });

              document.getElementById('unsubscribe').addEventListener('click', function() {
                  window.location.href = "/users/un-subscribe/" + "#{@user.email}"
              });

  #custom_ontologies_picker{style: "left: -9999px; position: absolute;"}
    = form_tag custom_ontologies_path(url_encode(@user.username)) do
      - selected = @user.customOntology.map {|o| LinkedData::Client::Models::Ontology.get(o).acronym}
      - locals = { custom_ontologies: @all_ontologies, selected_ontologies: selected, sel_text: "Select Custom Semantic Resources" }
      = render partial: "shared/ontology_picker", locals: locals
      = submit_tag "Save Custom Semantic Resources", class: "link_button"
